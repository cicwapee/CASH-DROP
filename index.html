<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Random Number Spinner</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="inventory">
            <h3>Инвентарь</h3>
            <ul id="inventory-list">
                <!-- Список инвентаря -->
            </ul>
        </div>
        <div>
            <button id="openCaseButton" onclick="generateNumber()">Открыть кейс</button>
            <button onclick="generateNumberFast()">Открыть быстро</button>
            <div class="spinner" id="spinner">
                <div class="numbers" id="numbers">
                    <!-- Numbers will be dynamically generated here -->
                </div>
                <div class="highlight"></div>
            </div>
            <div class="balance" id="balance">Баланс: $400</div>

            <div id="action-buttons" class="action-buttons">
                <button onclick="sellInventoryNumber(lastGeneratedNumber)">Продать</button>
                <button onclick="addToInventory()">Положить в инвентарь</button>
            </div>
        </div>
    </div>
    <script>
        let balance = parseInt(localStorage.getItem('balance')) || 400; // Считываем баланс из localStorage, если он есть, или ставим 400 по умолчанию
        let lastGeneratedNumber = null;
        let inventory = JSON.parse(localStorage.getItem('inventory')) || []; // Считываем инвентарь из localStorage
        let canOpenCase = true; // Флаг для проверки, можно ли открыть кейс
        let availableNumbers = []; // Массив доступных чисел
    
        // Обновляем баланс на экране
        function updateBalance() {
            const balanceElement = document.getElementById('balance');
            balanceElement.textContent = `Баланс: $${balance}`;
            localStorage.setItem('balance', balance); // Сохраняем баланс в localStorage
        }
    
        function generateNumber() {
            if (balance >= 100 && canOpenCase) {
                balance -= 100;
                canOpenCase = false; // Блокируем возможность открытия кейса
                updateBalance();
                document.getElementById('openCaseButton').disabled = true; // Блокируем кнопку открытия кейса
                spinWheel(3.5);
            } else if (!canOpenCase) {
                alert("Вы должны выбрать действие с числом перед тем, как открыть кейс.");
            } else {
                alert("Недостаточно средств на балансе!");
            }
        }
    
        function generateNumberFast() {
            if (balance >= 100 && canOpenCase) {
                balance -= 100;
                canOpenCase = false;
                updateBalance();
                document.getElementById('openCaseButton').disabled = true; // Блокируем кнопку открытия кейса
                spinWheel(1);
            } else if (!canOpenCase) {
                alert("Вы должны выбрать действие с числом перед тем, как открыть кейс.");
            } else {
                alert("Недостаточно средств на балансе!");
            }
        }
    
        function spinWheel(duration) {
            const minVisible = 1;    // Минимальное отображаемое число
            const maxVisible = 106;  // Максимальное отображаемое число
            const minPlayable = 34;  // Минимальное число, которое может выпасть
            const maxPlayable = 99;  // Максимальное число, которое может выпасть
            const spinner = document.getElementById('spinner');
            const numbersContainer = document.getElementById('numbers');
    
            numbersContainer.innerHTML = '';
    
            const numberWidth = 60;
            const spinnerWidth = spinner.offsetWidth;
            const centerOffset = (spinnerWidth / 2) - (numberWidth / 2);
    
            // Массив всех чисел от 1 до 106
            let allNumbers = [];
            for (let i = minVisible; i <= maxVisible; i++) {
                allNumbers.push(i);
            }
    
            // Числа от 34 до 99 перемешиваются в случайном порядке
            let playableNumbers = [];
            for (let i = minPlayable; i <= maxPlayable; i++) {
                playableNumbers.push(i);
            }
    
            // Объединяем массивы (сначала "недоступные" числа, потом перемешанные доступные)
            let sortedNumbers = [...allNumbers];
            for (let i = 0; i < playableNumbers.length; i++) {
                sortedNumbers[minPlayable - 1 + i] = playableNumbers[i];
            }
    
            // Создаем элементы для всех чисел
            sortedNumbers.forEach((number) => {
                const numberElement = document.createElement('div');
                numberElement.className = 'number';
                
                // Створюємо елемент зображення
                const imgElement = document.createElement('img');
                imgElement.src = `img/${number}.png`;  // Підставляємо шлях до зображення
                imgElement.alt = `Image for ${number}`;
                imgElement.className = 'number-image';  // Клас для стилів (за потреби)
            
                // Додаємо зображення до елемента
                numberElement.appendChild(imgElement);
            
                // Числа від 1 до 36 і від 100 до 106 візуально виділяємо
                if ((number >= 1 && number <= 36) || (number >= 100 && number <= 106)) {
                    imgElement.style.filter = 'grayscale(100%)'; // Додаємо ефект затінення
                }
            
                numbersContainer.appendChild(numberElement);
            });
            
            const startOffset = -(10 - minVisible) * numberWidth + centerOffset;
            numbersContainer.style.transition = 'none';
            numbersContainer.style.transform = `translateX(${startOffset}px)`;
    
            setTimeout(() => {
                // Мы убираем случайность чисел.
                // Теперь каждое число будет выплачиваться одно за другим.
                
                if (availableNumbers.length === 0) {
                    // Если доступных чисел больше нет, перезапускаем список.
                    availableNumbers = [];
                    for (let i = minPlayable; i <= maxPlayable; i++) {
                        availableNumbers.push(i);
                    }
                    shuffleArray(availableNumbers); // Перемешиваем доступные числа
                }

                // Берем следующее доступное число из массива
                const finalNumber = availableNumbers.pop();  // Убираем первое число из массива
                const finalOffset = -((finalNumber - minVisible) * numberWidth) + centerOffset;
    
                numbersContainer.style.transition = `transform ${duration}s ease-out`;
                numbersContainer.style.transform = `translateX(${finalOffset}px)`;
    
                lastGeneratedNumber = finalNumber;
    
                setTimeout(() => {
                    document.getElementById('action-buttons').style.display = 'block'; // Показываем кнопки после прокрута
                    document.querySelector('button[onclick="sellInventoryNumber(lastGeneratedNumber)"]').disabled = false; // Разблокируем кнопку продажи
                    document.querySelector('button[onclick="addToInventory()"]').disabled = false; // Разблокируем кнопку добавления в инвентарь
                }, duration * 1000);
            }, 50);
        }

        // Функция перемешивания массива
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
    
        function addToInventory() {
            inventory.push(lastGeneratedNumber);
            updateInventoryList();
            localStorage.setItem('inventory', JSON.stringify(inventory)); // Сохраняем инвентарь в localStorage
            resetAfterAction(); // Сбрасываем действия и кнопки
        }
    
        function sellInventoryNumber(number) {
            let price = 0;
    
            // Устанавливаем цены для чисел
            if ([34, 35, 92].includes(number)) {
                price = 767;
            } else if ([36, 42, 55, 62, 80, 82, 86].includes(number)) {
                price = 81;
            } else if ([37, 39, 41, 47, 53, 57, 61].includes(number)) {
                price = 53;
            } else {
                price = 5;
            }
    
            balance += price; // Добавляем цену к балансу
            updateBalance();
            inventory = inventory.filter(item => item !== number); // Удаляем число из инвентаря
            updateInventoryList();
            resetAfterAction(); // Сбрасываем действия и кнопки
        }
    
        function resetAfterAction() {
            document.getElementById('action-buttons').style.display = 'none';
            document.getElementById('openCaseButton').disabled = false; // Разблокируем кнопку открытия кейса
            canOpenCase = true; // Разрешаем открытие кейса
        }
    
        function updateInventoryList() {
            const inventoryList = document.getElementById('inventory-list');
            inventoryList.innerHTML = ''; // Очищаем текущий список инвентаря
            inventory.forEach((number) => {
                const listItem = document.createElement('li');
                listItem.textContent = `Число ${number}`;
                inventoryList.appendChild(listItem);
            });
        }
    
        // Загрузим инвентарь при старте
        updateInventoryList();
        updateBalance();  // Обновим баланс при загрузке страницы
    </script>
</body>
</html>
